name: Aspect Test

on:
  push:
    branches: [ ci_test ]
  pull_request:
    branches: [ ci_test ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Aspect Test
      run: |
        mkdir -p test_scripts
        cat > test_scripts/init_env.sh <<EOF
          source ~/.nvm/nvm.sh
          set -ex
          cd /aspect-tooling/packages/testcases
          sed -i "s|\"node\": \".*\"|\"node\": \"http://47.254.27.97:8545\"|g" project.config.json && cat project.config.json
          node scripts/create-account.cjs --skfile attack_accounts.txt
          node scripts/create-account.cjs --skfile privateKey.txt
          node scripts/create-account.cjs --skfile aspect_accounts.txt

          # node scripts/transfer.cjs --skfile attack_accounts.txt
          # node scripts/transfer.cjs --skfile privateKey.txt
          # node scripts/transfer.cjs --skfile aspect_accounts.txt
          
          # cd tests
          # node type-check-aspect.test.js
        EOF
        chmod +x test_scripts/init_env.sh
        docker run --name testenv -v $(pwd)/test_scripts:/test_scripts -id simonalphafang/aspect-tooling:0.0.3 /bin/bash -c /test_scripts/init_env.sh

